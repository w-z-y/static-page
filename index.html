<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å˜»å˜»</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        [v-cloak] {
            display: none;
        }

        #app {
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
        }

        .bg-mask {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.85);
            z-index: 0;
        }

        .content {
            position: relative;
            z-index: 1;
        }

        .coung {
            font-size: 60px;
            /* ä»å·¦åˆ°å³çš„æ¸å˜è‰² */
            background: linear-gradient(45deg, skyblue, pink);
            /* ä¸ºäº†åœ¨æ‰€æœ‰æµè§ˆå™¨ä¸­éƒ½èƒ½çœ‹åˆ°æ¸å˜æ•ˆæœï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªæµè§ˆå™¨å‰ç¼€ */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }

        .input-group {
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        label {
            width: 60px;
            text-align: right;
            margin-right: 10px;
            color: #666;
        }

        input {
            width: 120px;
            height: 30px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 0 10px;
            outline: none;
            transition: all 0.3s;
        }

        input:focus {
            border-color: #409eff;
            box-shadow: 0 0 5px rgba(64,158,255,.5);
        }

        input::placeholder {
            color: #999;
        }

        button {
            padding: 8px 20px;
            font-size: 16px;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 15px 8px;
        }

        .calc-btn {
            background: linear-gradient(45deg, #409eff, #42b983);
        }

        .save-btn {
            background: linear-gradient(45deg, #ff9900, #ff6666);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(64,158,255,0.3);
        }

        button:active {
            transform: translateY(0);
            box-shadow: none;
        }

        .error {
            border-color: #ff4444 !important;
        }

        .error-message {
            color: #ff4444;
            font-size: 12px;
            margin-top: 5px;
            min-height: 17px;
        }

        .bg-upload {
            margin: 15px 0;
        }

        .bg-upload input[type="file"] {
            display: none;
        }

        .bg-upload label {
            width: auto;
            padding: 8px 20px;
            background: linear-gradient(45deg, #ff9900, #ff6666);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .bg-upload label:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(64,158,255,0.3);
        }
    </style>
</head>

<body>
    <div id="app" v-cloak :style="bgStyle">
        <div class="bg-mask"></div>
        <div class="content">
            <div class="coung">{{totalMonths}}ä¸ªæœˆ{{remainingDays}}å¤©</div>
            <div class="coung">{{totalDays}}å¤©</div>
            <div class="input-group">
                <label for="year">å¹´ä»½</label>
                <input id="year" placeholder="è¯·è¾“å…¥å¹´ä»½" type="text" v-model="year" :class="{'error': errors.year}">
            </div>
            <div class="error-message" v-if="errors.year">{{errors.year}}</div>
            <div class="input-group">
                <label for="month">æœˆä»½</label>
                <input id="month" placeholder="è¯·è¾“å…¥æœˆä»½" type="text" v-model="month" :class="{'error': errors.month}">
            </div>
            <div class="error-message" v-if="errors.month">{{errors.month}}</div>
            <div class="input-group">
                <label for="day">æ—¥æœŸ</label>
                <input id="day" placeholder="è¯·è¾“å…¥æ—¥æœŸ" type="text" v-model="day" :class="{'error': errors.day}">
            </div>
            <div class="error-message" v-if="errors.day">{{errors.day}}</div>
            <div class="bg-upload">
                <label for="bgUpload">ä¸Šä¼ èƒŒæ™¯å›¾ç‰‡</label>
                <input id="bgUpload" type="file" accept="image/*" @change="handleBgUpload">
            </div>
            <button class="calc-btn" @click="saveToLocalStorage">è®¡ç®—</button>
        </div>
    </div>
    <script src="./lib/vue.min.js"></script>
    <script>
        const vm = new Vue({
            el: "#app",
            data() {
                return {
                    year: 2024,
                    month: 6,
                    day: 23,

                    totalDays: 0,
                    totalMonths: 0,
                    remainingDays: 0,//å‰©ä½™å¤©æ•°

                    errors: {
                        year: '',
                        month: '',
                        day: ''
                    },
                    bgImage: ''
                };
            },
            computed: {
                bgStyle() {
                    return this.bgImage ? {
                        backgroundImage: `url(${this.bgImage})`
                    } : {}
                }
            },
            created() {
                // ä»æœ¬åœ°ç¼“å­˜è¯»å–æ•°æ®
                const savedData = localStorage.getItem('babyBirthday');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    this.year = data.year;
                    this.month = data.month;
                    this.day = data.day;
                    this.bgImage = data.bgImage || '';
                }
                this.calcBabyDays();
            },
            methods: {
                handleBgUpload(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            this.bgImage = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                },
                validateInputs() {
                    this.errors = {
                        year: '',
                        month: '',
                        day: ''
                    };

                    let isValid = true;

                    // éªŒè¯å¹´ä»½
                    const yearNum = parseInt(this.year);
                    if (!this.year || isNaN(yearNum)) {
                        this.errors.year = 'è¯·è¾“å…¥æœ‰æ•ˆçš„å¹´ä»½';
                        isValid = false;
                    } else if (yearNum < 1900 || yearNum > 2100) {
                        this.errors.year = 'å¹´ä»½å¿…é¡»åœ¨1900-2100ä¹‹é—´';
                        isValid = false;
                    }

                    // éªŒè¯æœˆä»½
                    const monthNum = parseInt(this.month);
                    if (!this.month || isNaN(monthNum)) {
                        this.errors.month = 'è¯·è¾“å…¥æœ‰æ•ˆçš„æœˆä»½';
                        isValid = false;
                    } else if (monthNum < 1 || monthNum > 12) {
                        this.errors.month = 'æœˆä»½å¿…é¡»åœ¨1-12ä¹‹é—´';
                        isValid = false;
                    }

                    // éªŒè¯æ—¥æœŸ
                    const dayNum = parseInt(this.day);
                    if (!this.day || isNaN(dayNum)) {
                        this.errors.day = 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ—¥æœŸ';
                        isValid = false;
                    } else {
                        const daysInMonth = new Date(yearNum, monthNum, 0).getDate();
                        if (dayNum < 1 || dayNum > daysInMonth) {
                            this.errors.day = `æ—¥æœŸå¿…é¡»åœ¨1-${daysInMonth}ä¹‹é—´`;
                            isValid = false;
                        }
                    }

                    return isValid;
                },
                calcBabyDays() {
                    if (!this.validateInputs()) {
                        return;
                    }

                    console.log(this.year, this.month, this.day);
                    // ä½¿ç”¨å¸¸é‡å®šä¹‰ä¸€å¤©çš„æ¯«ç§’æ•°,æé«˜ä»£ç å¯è¯»æ€§
                    const MILLISECONDS_PER_DAY = 24 * 60 * 60 * 1000;

                    // ä½¿ç”¨Date.UTCç¡®ä¿æ—¶åŒºä¸€è‡´æ€§
                    const birthday = new Date(Date.UTC(this.year, this.month - 1, this.day));
                    const today = new Date();

                    // ä½¿ç”¨Math.absç¡®ä¿ç»“æœä¸ºæ­£æ•°
                    const timeDiff = Math.abs(today - birthday);

                    // è®¡ç®—æ€»å¤©æ•°
                    const totalDays = Math.ceil(timeDiff / MILLISECONDS_PER_DAY);
                    this.totalDays = totalDays;

                    // è®¡ç®—æœˆä»½å’Œå‰©ä½™å¤©æ•°
                    this.totalMonths = Math.floor(totalDays / 30);
                    this.remainingDays = totalDays % 30;

                    // ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²ä¼˜åŒ–æ—¥å¿—è¾“å‡º
                    console.log(`ğŸŒ· è·ç¦»å®å®ç”Ÿæ—¥è¿˜æœ‰ ${this.totalMonths}æœˆ${this.remainingDays}å¤© (å…±${totalDays}å¤©)`);
                },
                saveToLocalStorage() {
                    if (!this.validateInputs()) {
                        return;
                    }
                    this.calcBabyDays();
                    // ä¿å­˜åˆ°æœ¬åœ°ç¼“å­˜
                    const data = {
                        year: this.year,
                        month: this.month,
                        day: this.day,
                        bgImage: this.bgImage
                    };
                    localStorage.setItem('babyBirthday', JSON.stringify(data));
                    alert('ä¿å­˜æˆåŠŸï¼');
                }
            },
        });
    </script>
</body>

</html>